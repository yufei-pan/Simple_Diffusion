<!DOCTYPE html>
<html>
<head>
<script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<title>Simple Diffusion</title>
</head>
<body>
<header>Simple Diffusion</header>

<h1>Simple Diffusion - RESTful Diffusion Web Client</h1>
<a href='https://zopyr.us'>By Kes</a>

<div id="my_album">
    <a href = 'my_album'>My Album</a>
    <!-- An album of image generated by this machine (saved locally) -->
    <!-- What is saved is only the UUID and a nickname for each image -->
    <!-- Each image will have two button - delete and rename -->
    <!-- Also a button to save album locally (just a csv)-->
    <!-- Maybe a button to get a shareable link -->
    <!-- Shareable link is done by transmit the image ids to the server -->
    <!-- And the server will store this data in a albums db, access by another uuid -->
    <!-- Image is just raw doog loaded -->
</div>

<div id = 'Load_Image'>
    <h2>Load Image </h2>
    <h3 id="queue_pos_display">Position In Queue: <div id="queue_pos">Press Generate! First!</div></h3>
    <!-- Here we load the image somehow -->
    <!-- We either generate from promt, -->
    <!-- or load from a image in server database, -->
    <!-- or upload a image from local machine, -->
    <!-- or get a image silimar to a image in server db, -->
    <!-- or maybe load a image from a url (future feature?), -->
    
    <form id="generate">
        <fieldset>
            <legend>Method 1: Generate using prompt:</legend>
            <label for="positive_prompt_gen">Positive Prompt:</label><br>
            <input type="text" id="positive_prompt_gen" name="positive_prompt" value="high quality,highres,1girl,cloud, scenery, sunset"><br>
            <label for="negative_prompt_gen">Negative Prompt:</label><br>
            <input type="text" id="negative_prompt_gen" name="negative_prompt" value=""><br><br>
            <label for="ratio">Width Height Ratio: <p id="ratioDisplay">2</p></label>
            <input type="range" id="ratio" name="ratio" min="-3" max="3"value = "2" step='0.25' oninput="ratioDisplay.innerText = this.value"><br> <br>
            <label for="sampler_gen">Sampler Method:</label><br>
            <input type="radio" id="DPM2KA_gen" name="sampler_gen" value="DPM2KA" checked="checked">
            <label for="DPM2KA_gen">Default: DMP2 Karras</label><br>
            <input type="radio" id="Heun_gen" name="sampler_gen" value="Heun">
            <label for="Heun_gen">More Creative: Heun</label><br>
            <input type="radio" id="DDIM_gen" name="sampler_gen" value="DDIM">
            <label for="DDIM_gen">Neural: DDIM</label><br>
            <input type="radio" id="Eular_a_gen" name="sampler_gen" value="Eular_a">
            <label for="Eular_a_gen">Something different: Eular Ancestry</label><br>
            <input type="radio" id="LMS_gen" name="sampler_gen" value="LMS">
            <label for="LMS_gen">Stable: LMS</label><br><br>
            <label for="seed_gen">Seed:</label><br>
            <input type="text" id="seed_gen" name="seed" value="-1"><br>
            <input type="submit" value="Generate!">
        </fieldset>
    </form>
    <form id="load_from_server">
        <fieldset>
            <legend>Method 2: Load a image in server:</legend>
            <label for="load_uuid">Load image UUID:</label><br>
            <input type="text" id="load_uuid" name="load_uuid" value=""><br>
            <input type="submit" value="Generate!">
        </fieldset>
    </form>
    <form id="generate_like">
        <fieldset>
            <legend>Method 3: Generate image using tags from image in server:</legend>
            <label for="like_uuid">Generate use image UUID:</label><br>
            <input type="text" id="like_uuid" name="like_uuid" value=""><br>
            <input type="submit" value="Generate!">
        </fieldset>
    </form>
    <form id="upload_image">
        <fieldset>
            <legend>Method 4: Upload and load a image from local machine:</legend>
            <label for="myfile">Select a file:</label>
            <input type="file" id="myfile" name="file"><br><br>
            <input type="submit" value="Generate!">
        </fieldset>
    </form>
</div>

<div id="Source_Image_View">
    <!-- Here is the image view window -->
    <!-- We will also have a button to download the picture -->
    <div id="Source_Image">
        <img src="static/source_image_placeholder.webp" alt="Source Image Here">
    </div>
</div>

<div id="Info">
    <!-- Here we will put a button to load related info about the image -->
    <button type="button" id="info_button">Info about Pic Above</button>
</div>

<div id = 'Queue_View'>
    <!-- Here is the queue from the server, updated automaticly  -->

</div>

<div id="Process_div">
    <!-- Here we put the prompts for further processing -->
    <!-- Here we put a Button to upscale the Image using SwinIR -->
    <!-- Will adapt height and width automaticlly -->
    <form id="process">
        <fieldset>
            <legend>How you want to tweeck the picture:</legend>
            <label for="positive_prompt_process">Positive Prompt:</label><br>
            <input type="text" id="positive_prompt_process" name="positive_prompt" value=""><br>
            <label for="negative_prompt_process">Negative Prompt:</label><br>
            <input type="text" id="negative_prompt_process" name="negative_prompt" value=""><br>
            <br>
            <label for="denoise_strength">Creativity Delta: <p id="denoiseDisplay">0</p></label>
            <input type="range" id="denoise_strength" name="denoise_strength" min="-69" max="69"value = "0" step='1' oninput="denoiseDisplay.innerText = this.value"><br>
            <br>
            <label for="sampler_process">Sampler Method:</label><br>
            <input type="radio" id="DDIM_process" name="sampler_process" value="DDIM" checked="checked">
            <label for="DDIM_process">Default: Inspired: DDIM</label><br>
            <input type="radio" id="LMS_process" name="sampler_process" value="LMS">
            <label for="LMS_process">Enhance: LMS</label><br>
            <input type="radio" id="DPM2KAA_process" name="sampler_process" value="DPM2KAA">
            <label for="DPM2KAA_process">Regeneration: DMP2 a Karras</label><br>
            <input type="radio" id="Heun_process" name="sampler_process" value="Heun">
            <label for="Heun_process">Redraw: Heun</label><br>
            <input type="radio" id="Eular_a_process" name="sampler_process" value="Eular_a">
            <label for="Eular_a_process">More Creative: Eular Ancestry</label><br>
            <br>
            <label for="seed_process">Seed:</label><br>
            <input type="text" id="seed_process" name="seed" value="-1"><br>
            <input type="submit" value="Generate!">
        </fieldset>
    </form>
</div>

<div id="Final_Image_View">
    <!-- Here is the image view for image after diffusing -->
    <!-- Also a Download button will be here -->
    <!-- Also a button to send to original image view -->
    <!-- This is done by simpily remove image from here, add image to above -->
    <!-- Importantly, the hidden ID for the image in source will be the UUID of pic -->
    <img alt="The generated image will be here"><br>
    <button type="button" id="Download">Download</button>   
    <button type="button" id="send_to_process">Send to Process again</button>
</div>


<script type = "text/javascript">
    $(document).ready( function () {
        // Section for handling loading of image
        $('#generate').on( "submit", function(e){
            console.log('Generating results using');
            var ele = document.getElementsByName('sampler_gen');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                sampler_gen = ele[i].value;
            }
            
            var genDic = {
                Positive:$('#positive_prompt_gen').val(),
                Negative:$('#negative_prompt_gen').val(),
                Ratio:$('#ratio').val(),
                Sampler: sampler_gen,
                Seed:$('#seed_gen').val()
            };
            console.log(genDic);
            $.post("new",genDic, function(data) {
                console.log("Response: ");
                console.log(data);
                $('#queue_pos').html(data['Queue'])
            }, "json");
          e.preventDefault();
        });

        $('#load_from_server').on( "submit", function(e){
            console.log('Load image using');
            var uuidReq = $('#load_uuid').val()
            console.log(uuidReq);
            $.post("image",{uuid:uuidReq}, function(data) {
                console.log("Response: ");
                console.log(data);
                $('#queue_pos').html(data['Queue'])
            }, "json");
          e.preventDefault();
        });
    }
    ); 
</script>
<footer></footer>
</body>
</html>
